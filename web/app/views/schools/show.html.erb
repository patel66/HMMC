<link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="http://github.hubspot.com/odometer/themes/odometer-theme-plaza.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <script src="http://github.hubspot.com/odometer/odometer.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://dinbror.dk/bpopup/assets/jquery.bpopup-0.9.4.min.js"></script>
    <script src="http://dinbror.dk/bpopup/assets/jquery.easing.1.3.js"></script>
<!-- clone -->

<style type="text/css">
a {
  color:inherit;
}
  th
{
border-right: 1px solid rgba(0,0,0,0.25);
}

  .flat-table {
    margin-bottom: 20px;
    border-collapse:collapse;
    font-family: 'Lato', Calibri, Arial, sans-serif;
    border: none;
                border-radius: 3px;
               -webkit-border-radius: 3px;
               -moz-border-radius: 3px;
  }
  .flat-table th, .flat-table td {
    box-shadow: inset 0 -1px rgba(0,0,0,0.25),
      inset 0 1px rgba(0,0,0,0.25);
  }
  .flat-table th {
    font-weight: normal;
    -webkit-font-smoothing: antialiased;
    padding: 1em;
    color: rgba(0,0,0,0.45);
    text-shadow: 0 0 1px rgba(0,0,0,0.1);
    font-size: 1.5em;
  }
  .flat-table td {
    color: #f7f7f7;
    padding: 0.7em 1em 0.7em 1.15em;
    text-shadow: 0 0 1px rgba(255,255,255,0.1);
    font-size: 1.4em;
  }
  .flat-table tr {
    -webkit-transition: background 0.3s, box-shadow 0.3s;
    -moz-transition: background 0.3s, box-shadow 0.3s;
    transition: background 0.3s, box-shadow 0.3s;
  }

  .flat-table-3 {
    display:none;
    background: #52be7f;
 /*   background: SeaGreen;*/
   /* opacity: 0.1;*/
  }

  .flat-table-2 {
    display:none;
  }

  .flat-table-3 tr:hover {
    background: rgba(0,0,0,0.1);
  }

  .ui-tooltip, .arrow:after {
    background: steelblue;
    border: 2px solid white;
  }

  .flat-table-2 tr:hover {
    background: rgba(0,0,0,0.1);
  }
  .flat-table-2 {
    background: #f06060;
  }

   .flat-table-1 {
    background: #336ca6;
    display:none;
  }

  .flat-table-1 tr:hover {
    background: rgba(0,0,0,0.19);
  }

  .goalamount {
    position:relative;
    top:-130px;

  }
</style>

<table class="flat-table flat-table-3">
  <thead>
    <th COLSPAN="3" style="text-align:center">
       National Rankings
    </th>
   </TR>
  </thead>
  <thead>
    <th>Rank</th>
    <th style="text-align:center">School</th>
    <th>Total Miles</th>
  </thead>
  <tbody>
<% if @national_ranked_school_table.nil? == false %>
<%@national_ranked_school_table.each_index do |index| %>
    <tr>
      <td><%=index + 1%></td>
      <td><a href="/schools/<%=@national_ranked_school_table[index].id%>"><%=@national_ranked_school_table[index].name%></a></td>
      <td><%=@national_ranked_school_table[index].total_miles_school%></td>
    </tr>
<%end%>
<%end%>
  </tbody>
</table>





<table class="flat-table flat-table-2">
  <thead>
    <th COLSPAN="3" style="text-align:center">
       City Rankings: <%=@users_school.city%>
    </th>
   </TR>
  </thead>
  <thead>
    <th>Rank</th>
    <th>School</th>
    <th>Total Miles </th>
  </thead>
  <tbody>
   <% if @city_ranked_school_table.nil? == false %>
    <tr>
      <%@city_ranked_school_table.each_index do |index| %>
      <td><%=index + 1%></td>
      <td><a href="/schools/<%=@city_ranked_school_table[index].id%>"><%=@city_ranked_school_table[index].name%></a></td>
      <td><%=@city_ranked_school_table[index].total_miles_school%></td>
    </tr>
      <%end%>
    <%end%>
  </tbody>
</table>

<table class="flat-table flat-table-1">
  <thead>
    <th COLSPAN="3" style="text-align:center">
       State Rankings: <%=@users_school.state%>
    </th>
   </TR>
  </thead>
  <thead>
    <th>Rank</th>
    <th>School</th>
    <th>Total Miles </th>
  </thead>
  <tbody>
   <% if @state_ranked_school_table.nil? == false %>
    <tr>
      <%@state_ranked_school_table.each_index do |index| %>
      <td><%=index + 1%></td>
      <td><a href="/schools/<%=@state_ranked_school_table[index].id%>"><%=@state_ranked_school_table[index].name%></a></td>
      <td><%=@state_ranked_school_table[index].total_miles_school%></td>
    </tr>
      <%end%>
    <%end%>
  </tbody>
</table>




<div class="container">
	<div class="row slideLeft bigEntrance">

		<div class="school-info-sidebar col-md-3 box">
			<div class="school-details row">
				<h1><%=@school.name %></h2>
				<h5><%=@school.city + ", "+@school.state %></h5>
			</div>
			<div class="school-details row">
				<a id="show-national" href="#" title="Click to show National Rankings"><h3>National Rank: <span id="display_nat_rank"><%=@nationalrank%></span></h3></a>
				<h3 id="state_rank">State Rank: <span id="display_state_rank"><%=@staterank%> </span></h3>
				<a id="city_rank" href="#" title="Click to show City Rankings"><h3 id="city_rank">City Rank: <span id="display_city_rank"><%=@cityrank%></span></h3></a>

			</div>
			<div class="school-details row">
				<h2>Students Participating</h2>
				<h2 id="students_number"><%=@school.students%></h2>
			</div>

		</div>
		<div class="school-stats-section col-md-6">
			<!-- <h1 id="miles">15,465 </h1> -->
			<div id="odometer" class="odometer"><%=@school.total_miles_school%></div>
			<!-- <h4 id="miles"> Miles Ran</h4> -->
    		<!-- <input></input>
	 	   <button></button> -->

      	<div id="donut" data-donut="30">

	    </div>
        <!-- <div class="goalamount"><h3>Goal: 100000</h3> -->
	      <div class="goal"><h3 style ="padding-top:8px"> Of Goal Met </h3><h3 class="goalamount">Goal: <span id="goal_display">10000</span></h3>
		</div>
	    <div id="win"></div>

	    	<div>
	    	</div>
	    <!-- input id="goal"></input
	    <input id="miles"></input>
	    <button></button> -->

		</div>

		<div class="ranking col-md-3 box">
			<h1>Achievements</h1>
			<div class="achievements">
				<%=image_tag('reach.png') %>
				<%=image_tag('1.png') %>
				<%=image_tag('Veteran.png') %>
				<%=image_tag('1k.png', class: "1k_icon") %>
				<%=image_tag('5k.png', class: "5k_icon") %>
				<%=image_tag('10k.png', class: "10k_icon") %>
				<%=image_tag('20k.png', class: "20k_icon") %>
				<%=image_tag('25k.png', class: "25k_icon")%>
				<%=image_tag('50k.png', class: "50k_icon") %>
			</div>

		</div>

    <% if session[:app_sid].empty? == false %>

        <% if @c_school.id == params[:id].to_i%>
            <div class="row">
              <div class="col-md-6 col-md-offset-3">

                <div class="user-actions ">
                  <!-- <div class="goalamount"><h3>Goal: 100000</h3></div> -->
                  <div class="action-icons">
                    <a id="add-those-miles" title="Add miles to your school!"><i id="addMiles" class="fa fa-plus-square"></i></a>

                    <a id="account-information" title="Account Information"><i id="addStudents" class="fa fa-child"></i></a>

                    <a id="calender-information" title="Calender"><i id="history" class="fa fa-calendar"></i></a>
                  </div>
                </div>

              </div>
            </div>

  <div  class="addMiles" >
    <div class="row">
      <div class="page-header"><!--<h2>Add Miles</h2> --></div>
      <form class="form-horizontal">
        <fieldset>
          <!-- Mile input-->

          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Miles</h3>
              </div>
              <div class="col-md-6">
                <input id="mile" name="mile" type="number" placeholder="Enter Miles Ran" class="form-control input-lg">
                <input id="school_page_id" name="school_id" type="hidden" value=<%=params[:id]%>>
                <input id="date_for_activity" name="date_activity" type="hidden" value=<%=Time.now%>>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Students</h3>
              </div>
              <div class="col-md-6">
                <input id="studentsP" name="studentsP" type="number" placeholder="Students Participating" class="form-control input-lg">
              </div>
            </div>
          </div>

          <!-- Button (Double) -->

          <div class="form-group">
            <label class="col-md-3 control-label" for="log"></label>
          <div class="col-md-6">
            <button id="log" name="log" class="btn btn-block btn-success">Log Activity</button>
          </div>
        </fieldset>
      </form>
    </div> <!--./row -->
  </div> <!--./container -->

  <div  class="profile" >
    <div class="row">
      <div class="page-header"><h2>School Profile</h2></div>
      <form class="form-horizontal">
        <fieldset>
         <!--  <div class="page-header">
              <h3><%= @school.name %></h3>
            <h3><%= @school.street %></h3>
            <h3><%= @school.city + ", " + @school.state %></h3>
          </div> -->
          <!-- Mile input-->
          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Total Students</h3>
              </div>
              <div class="col-md-6">
                <input id="students" name="students" type="number" value="<%=@school.students %>" class="form-control input-lg">
              </div>
            </div>
          </div>
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Goal</h3>
              </div>
              <div class="col-md-6">
                <input id="schoolGoal" name="schoolGoal" type="number" value="<%=@school.goal%>" class="form-control input-lg">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Coach</h3>
              </div>
              <div class="col-md-6">
                <input id="name" name="name" type="text" value="<%=@coach.name %>" class="form-control input-lg">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <div class="col-md-6">
                <h3>Email</h3>
              </div>
              <div class="col-md-6">
                <input id="email" name="email" type="text" value="<%=@coach.email %>" class="form-control input-lg">
              </div>
            </div>
          </div>

          <!-- Button (Double) -->
          <div class="form-group">
            <label class="col-md-3 control-label" for="save"></label>
          <div class="col-md-6">
            <button id="save" name="save" class="btn btn-block btn-success">Save</button>
          </div>
        </fieldset>
      </form>
    </div> <!--./row -->
  </div> <!--./container -->
        <%end %>
    <%end %>
<!--
  <div class="historylist">
    <h3>History of Activity:</h3>
    <ul style="list-style-type: none">
      <% @school.activitys.each do |activity| %>
      <li>
      <%="Miles ran: #{activity.miles} " %>

      <%="Students: #{activity.students} "%>
      <%="Date: #"%>
      </li>
      <%end%>
    </ul>
  </div> -->

<table class="historylist">
  <thead>
    <tr>
      <th>Miles</th>
      <th>Students</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody>

    <%@school.activitys.each do |activity| %>
      <tr>
        <td><%=activity.miles%></td>
          <td style="text-align:center"><%= activity.students%></td>
        <td><%=activity.date.month%>-<%=activity.date.day%>-<%=activity.date.year%></td>
      </tr>
    <%end%>



  </tbody>
</table>

<%school_miles = @school.total_miles_school%>

 <!-- Odometer Script -->
  <script>
var school_total_miles = <%=@school.total_miles_school%>
console.log(school_total_miles)
  $(".1k_icon").css({ opacity: 0.2 });
  $(".5k_icon").css({ opacity: 0.2 });
  $(".10k_icon").css({ opacity: 0.2 });
  $(".20k_icon").css({ opacity: 0.2 });
  $(".25k_icon").css({ opacity: 0.2 });
  $(".50k_icon").css({ opacity: 0.2 });

if (school_total_miles >= 1000) {
  $(".1k_icon").css({ opacity: 1 });
}

if (school_total_miles >= 5000) {
  $(".5k_icon").css({ opacity: 1 });
}

if (school_total_miles >= 10000) {
  $(".10k_icon").css({ opacity: 1 });
}

if (school_total_miles >= 20000) {
  $(".20k_icon").css({ opacity: 1 });
}
if (school_total_miles >= 25000) {
  $(".25k_icon").css({ opacity: 1 });
}

if (school_total_miles >= 50000) {
  $(".50k_icon").css({ opacity: 1 });
}

  $("#save").on("click",function(e){
    e.preventDefault();
    // alert("/schools/" + <%=@school.id%>);
     $.ajax({
      type: "put",
      headers: {
      'X-Transaction': 'POST Example',
      'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
      },
      url: "/schools/" + <%=@school.id%>,
      dataType: "json",
      //contentType: "application/json",
      data: {students: $('#students').val(), goals :$("#schoolGoal").val()},
      success: function(data) {
        $("#students_number").text(data.students)
          goal = data.goals
        // console.log(goal)
        $("#goal_display").text(data.goals)
        // window.data = data;
        // console.log("The current player is " + data.game.turns[data.game.turns.length-1].player)
        //  $("#current_player").text("Hey " + data.game.turns[data.game.turns.length-1].player + " make a move!")
        // console.log(data.roll_for_current)
        // console.log("shot amount " +data.wound_for_current)
        // $("#shot").text(data.game.turns[data.game.turns.length-1].player + " got shot " + data.wound_for_current + " time(s)")
        // console.log("food amount " + data.score_for_current)
        // $("#food").text(data.game.turns[data.game.turns.length-1].player + " got food, " + data.score_for_current + " rabbit liver(s) collected")
        // $(".score_board #"+data.game.turns[data.game.turns.length-1].player+"").after().text(data.game_score)
        console.log("hi")
      },
      error: function(data) {
        console.log(data);
        alert(data);
      }
    });
  })

    var duration   = 2000;
    var transition = 100;

    var goal = 10000; // school's preset goal! // have input for this
    var total = school_total; // school's total miles // from backend!!

  var num = total/goal * 100
  var school_total = <%=school_miles%>
    //     setTimeout(function(){
    //     odometer.innerHTML = 456;
    // }, 1000);
    // odometer.innerHTML = school total miles + num
    var y = $(window).scrollTop();  //your current y position on the page
    $("#addMiles").on("click", function(){
    	$(".addMiles").slideToggle();
    	$(".profile").hide();
    	$(".history").hide();
		$(window).scrollTop(y+150);
    });

    $("#addStudents").on("click", function(){
    	$(".profile").slideToggle();
    	$(".addMiles").hide();
    	$(".history").hide();
		$(window).scrollTop(y+150);
    });

     $("#history").on("click", function(){
    	$(".history").slideToggle();
    	$(".addMiles").hide();
    	$(".profile").hide();
		$(window).scrollTop(y+150);
    });


     $( ".selector" ).tooltip({ position: { my: "left+15 center", at: "right center" } });
   $(function() {
      $( "#show-national" ).tooltip({
        position: { my: "left+15 center", at: "right center" },
        show: {
          effect: "slideToggle",
          delay: 250
        }
      });
      $( "#add-those-miles" ).tooltip({
        position: { my: "left center", at: "left-50 top+100" },
        show: {
          effect: "slideToggle",
          delay: 150
        }
      });
      $( "#account-information" ).tooltip({
        position: { my: "left center", at: "left-40 top+100" },
        show: {
          effect: "slideToggle",
          delay: 150
        }
      });
      $( "#calender-information" ).tooltip({
        position: { my: "left center", at: "left+10 top+100" },
        show: {
          effect: "slideToggle",
          delay: 150
        }
      });
    });


     // the original click
    // $("button").on("click",function(){
    //   var num = +$("input").val();
    //   odometer.innerHTML = num;
    // });

// $("input[value='roll_dice']").on("click",function(e){
//     e.preventDefault();
//     $.ajax({
//       type: "PUT",
//       url: "/games/" + gameId,
//       dataType: "json",
//       data:{game_id: gameId, move: "roll_dice"},
//       success: function(data) {
//         window.data = data;
//         console.log("The current player is " + data.game.turns[data.game.turns.length-1].player)
//          $("#current_player").text("Hey " + data.game.turns[data.game.turns.length-1].player + " make a move!")
//         console.log(data.roll_for_current)
//         console.log("shot amount " +data.wound_for_current)
//         $("#shot").text(data.game.turns[data.game.turns.length-1].player + " got shot " + data.wound_for_current + " time(s)")
//         console.log("food amount " + data.score_for_current)
//         $("#food").text(data.game.turns[data.game.turns.length-1].player + " got food, " + data.score_for_current + " rabbit liver(s) collected")
//         $(".score_board #"+data.game.turns[data.game.turns.length-1].player+"").after().text(data.game_score)

//       }
//     });

//   });

  $("#show-national").on("click",function(e){
    $('.flat-table-3 ').bPopup({
      easing: 'easeOutBack', //uses jQuery easing plugin
      speed: 1250,
      transition: 'slideIn'
    });
  });

  $("#city_rank").on("click",function(e){
    $(".flat-table-2").bPopup({
      easing: 'easeOutBack',
      speed:1250,
      transition: 'slideDown'
    })

  })

  $("#state_rank").on("click",function(e){
    $(".flat-table-1").bPopup({
      easing: 'easeOutBack',
      speed:1250,
      transition: 'slideDown'
    })
  })

    $(".fa-calendar").on("click",function(e){
    $(".historylist").bPopup({
      easing: 'easeOutBack', //uses jQuery easing plugin
      speed: 1250,
      transition: 'slideDown'
    })
  })


  $("#log").on("click",function(e){
    var miles = +$("#mile").val();
    var students = +$("#studentsP").val();
    var activity_date = $("#date_for_activity").val();
    var school_id_page = $("#school_page_id").val();

    console.log(miles)
    e.preventDefault();
     $.ajax({
      headers: {
      'X-Transaction': 'POST Example',
      'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
      },
      type: "POST",
      dataType: "json",
      url: "/activities",
      data: {miles: miles, students: students, school_id: school_id_page, date: activity_date},
      success: function(data) {
        window.xyz = data
        odometer.innerHTML = data.schoolmiles
        $("#display_nat_rank").text(data.national_rank)
        $("#display_city_rank").text(data.city_rank)
        $("#display_state_rank").text(data.state_rank)
        console.log(data);
        if (data.schoolmiles >= 1000) {
          $(".1k_icon").css({ opacity: 1 });
        }

        if (data.schoolmiles >= 5000) {
          $(".5k_icon").css({ opacity: 1 });
        }

        if (data.schoolmiles >= 10000) {
          $(".10k_icon").css({ opacity: 1 });
        }

        if (data.schoolmiles >= 20000) {
          $(".20k_icon").css({ opacity: 1 });
        }
        if (data.schoolmiles >= 25000) {
          $(".25k_icon").css({ opacity: 1 });
        }

        if (data.schoolmiles >= 50000) {
          $(".50k_icon").css({ opacity: 1 });
        }
      }
    });



  var msglist = document.getElementById("donut");
  var x = +$("#mile").val();

  console.log(x)
  msglist.setAttribute("data-donut","");
  total+= x
  console.log(total)

  var show = msglist.getAttribute("data-donut");
  console.log(num)
  // per = ((total+parseInt(x))/goal)*100

  msglist.setAttribute("data-donut", num ) ;

   $("#donut").empty();

   var num = total/goal * 100
   // if (num >= 100) {
   //  $("#win").text("YOU GUYS DID IT!!!!!")
   // }
  drawDonutChart(
  '#donut',
  num,
  260,
  260,
  ".45em"
  );

  });


<!-- Graph script -->


 var duration   = 2000;
 var transition = 100;

var goal = 10000; // school's preset goal! // have input for this
var total = school_total; // school's total miles // from backend!!

  var num = total/goal * 100

  drawDonutChart(
  '#donut',
  num,
  260,
  260,
  ".45em"
  );

// original click
// $("button").on("click",function(e){
  // e.preventDefault();
  // var msglist = document.getElementById("donut");
  // var x = +$("#mile").val();

  // console.log(x)
  // msglist.setAttribute("data-donut","");
  // total+= x
  // console.log(total)

  // var show = msglist.getAttribute("data-donut");
  // console.log(num)
  // // per = ((total+parseInt(x))/goal)*100

  // msglist.setAttribute("data-donut", num ) ;

  //  $("#donut").empty();

  //  var num = total/goal * 100
  //  if (num >= 100) {
  //   $("#win").text("YOU GUYS DID IT!!!!!")
  //  }
  // drawDonutChart(
  // '#donut',
  // num,
  // 260,
  // 260,
  // ".45em"
  // );

// });


function drawDonutChart(element, percent, width, height, text_y) {
  width = typeof width !== 'undefined' ? width : 200;
  height = typeof height !== 'undefined' ? height : 200;
  text_y = typeof text_y !== 'undefined' ? text_y : "-.10em";

  var dataset = {
        lower: calcPercent(0),
        upper: calcPercent(percent)
      },
      radius = Math.min(width, height) / 2,
      pie = d3.layout.pie().sort(null),
      format = d3.format(".0%");

  var arc = d3.svg.arc()
        .innerRadius(radius - 20)
        .outerRadius(radius);

  var svg = d3.select(element).append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

  var path = svg.selectAll("path")
        .data(pie(dataset.lower))
        .enter().append("path")
        .attr("class", function(d, i) { return "color" + i })
        .attr("d", arc)
        .each(function(d) { this._current = d; }); // store the initial values

  var text = svg.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", text_y);

  if (typeof(percent) === "string") {
    text.text(percent);
    console.log(percent)

  }
  else {
    var progress = 0;
    var timeout = setTimeout(function () {
      clearTimeout(timeout);
      path = path.data(pie(dataset.upper)); // update the data
      path.transition().duration(duration).attrTween("d", function (a) {
        // Store the displayed angles in _current.
        // Then, interpolate from _current to the new angles.
        // During the transition, _current is updated in-place by d3.interpolate.
        var i  = d3.interpolate(this._current, a);
        var i2 = d3.interpolate(progress, percent)
        this._current = i(0);
        return function(t) {
          text.text( format(i2(t) / 100) );
          return arc(i(t));
        };
      }); // redraw the arcs
    }, 200);
  }
};

function calcPercent(percent) {
  return [percent, 100-percent];
};
</script>
